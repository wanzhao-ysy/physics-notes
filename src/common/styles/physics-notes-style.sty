\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{physics-notes-style}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% physics-notes-style 调用的宏包
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\RequirePackage{import}
%
% 字体支持
\RequirePackage{xcolor}
%
% 中文支持
\RequirePackage[UTF8, scheme=chinese, heading=true, fontset=lxgw]{ctex}
%
%
% 参考文献支持
\RequirePackage[backend=biber,style=gb7714-2015, sorting=none,backref=true]{biblatex}
%
% 基础宏包（数学）

\RequirePackage{amsmath,amsthm,bm}
\RequirePackage{amssymb,latexsym,textcomp,euscript,euscript,yhmath}
\RequirePackage{fixdif}
\RequirePackage{mathtools}
\RequirePackage{polynom}
\RequirePackage{esint}
%
% 物理专用宏包
\RequirePackage{siunitx}
\sisetup{inter-unit-product = \ensuremath{{}\cdot{}}}
\DeclareSIUnit\angstrom{\text{\AA}}
\RequirePackage{physics2}
%
% 图形和布局
\PassOptionsToPackage{no-math}{fontspec}
\RequirePackage{graphicx,float,caption,subcaption}
\RequirePackage{tikz}
\usetikzlibrary{arrows.meta,angles,quotes,calc,patterns}
\RequirePackage[
    inner=2cm,
    outer=1.5cm,
    top=2cm,
    bottom=1cm,
    marginparwidth=2cm,
    marginparsep=0.4cm,
    includefoot,
    heightrounded
]{geometry}
\RequirePackage{multicol}
\RequirePackage{tabularray}
\RequirePackage{scalerel}
\RequirePackage{booktabs}
\RequirePackage{multirow}


% tcolorbox 及其库
\RequirePackage{tcolorbox}
\tcbuselibrary{skins,breakable,theorems}
%
% 字体问题处理
\RequirePackage{lmodern}
%
% 图、表、公式编号
\numberwithin{figure}{chapter}
\numberwithin{table}{chapter}
\numberwithin{equation}{chapter}
%
% 页面设置
%\raggedbottom
%
% 超链接支持
\RequirePackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=red,
    citecolor=red,
    urlcolor=red,
    bookmarksnumbered=true,
    pdfstartview=FitH
}
%
% 智能引用支持
\RequirePackage{cleveref}
\crefname{equation}{公式}{公式}
\Crefname{equation}{公式}{公式}
\crefname{table}{表}{表}
\Crefname{table}{表}{表}
\crefname{figure}{图}{图}
\Crefname{figure}{图}{图}
\crefformat{section}{#2#1#3节}
\Crefformat{section}{#2#1#3节}
\crefformat{chapter}{第#2#1#3章}
\Crefformat{chapter}{第#2#1#3章}
\crefformat{page}{第#2#1#3页}
\Crefformat{page}{第#2#1#3页}
%
% 书签支持
\RequirePackage{bookmark}
%
% ==========================================
% 物理笔记专用环境定义
% ==========================================
%
% 1. 定义环境
\newtcbtheorem[
    number within=section,
    Crefname={定义}{定义},
    crefname={定义}{定义}
]{definition}{定义}
{
    colback=blue!5!white,
    colframe=blue!75!black,
    fonttitle=\bfseries,
    breakable,
    enhanced,
    attach boxed title to top left={xshift=5mm, yshift=-2mm},
    boxed title style={colback=blue!75!black},
}{def}
%
% 2. 定律环境
\newtcbtheorem[
    number within=section,
    Crefname={定律}{定律},
    crefname={定律}{定律}
]{law}{定律}
{
    colback=green!5!white,
    colframe=green!75!black,
    fonttitle=\bfseries,
    breakable,
    enhanced,
    attach boxed title to top left={xshift=5mm, yshift=-2mm},
    boxed title style={colback=green!75!black},
}{law}
%
% 3. 定理环境
\newtcbtheorem[
    number within=section,
    Crefname={定理}{定理},
    crefname={定理}{定理}
]{theorem}{定理}
{
    colback=orange!5!white,
    colframe=orange!75!black,
    fonttitle=\bfseries,
    breakable,
    enhanced,
    attach boxed title to top left={xshift=5mm, yshift=-2mm},
    boxed title style={colback=orange!75!black},
}{theorem}
%
% 4. 注释环境
\newtcbtheorem[
    number within=section,
    Crefname={注释}{注释},
    crefname={注释}{注释}
]{note}{注释}
{
    colback=yellow!5!white,
    colframe=yellow!75!black,
    fonttitle=\bfseries,
    breakable,
    enhanced,
    attach boxed title to top left={xshift=5mm, yshift=-2mm},
    boxed title style={colback=yellow!75!black},
}{note}
%
% 5. 例环境
\newtcbtheorem[
    number within=section,
    Crefname={例}{例},
    crefname={例}{例}
]{example}{例}
{
    colback=red!5!white,
    colframe=red!75!black,
    fonttitle=\bfseries,
    breakable,
    enhanced,
    attach boxed title to top left={xshift=5mm, yshift=-2mm},
    boxed title style={colback=red!75!black},
}{example}
%
% 6. 示例环境
\newtcbtheorem[
    number within=section,
    Crefname={示例}{示例},
    crefname={示例}{示例}
]{illustration}{示例}
{
    colback=purple!5!white,
    colframe=purple!75!black,
    fonttitle=\bfseries,
    breakable,
    enhanced,
    attach boxed title to top left={xshift=5mm, yshift=-2mm},
    boxed title style={colback=purple!75!black},
}{illustration}
%
% 7. 引用环境
\newtcbtheorem[
    number within=section,
    Crefname={引用}{引用},
    crefname={引用}{引用}
]{Citation}{引用}
{
    colback=teal!5!white,
    colframe=teal!75!black,
    fonttitle=\bfseries,
    breakable,
    enhanced,
    attach boxed title to top left={xshift=5mm, yshift=-2mm},
    boxed title style={colback=teal!75!black},
}{Citation}
%
%==========================================
%
% 页眉页脚设定 (利用 fancyhdr 实现)
\RequirePackage{fancyhdr}
\addtolength{\headheight}{1.6pt}
\pagestyle{fancy}
\fancyhf{} % 清空默认的页眉页脚设置
%
% 设定页眉内容
% 偶数页 (Even)：左页码 (LE)，右章名 (RE)
\fancyhead[LE]{\bfseries\thepage}
\fancyhead[RE]{\bfseries\leftmark}
% 奇数页 (Odd)：左节名 (LO)，右页码 (RO)
\fancyhead[LO]{\bfseries\rightmark}
\fancyhead[RO]{\bfseries\thepage}
%
% 设定页眉线宽
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}
%
% 设定章节标记格式
\renewcommand{\chaptermark}[1]{\markboth{\if@mainmatter\CTEXthechapter\fi\quad #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\S\thesection\quad #1}}
%
% 令 \cleardoublepage 的偶数页页眉页脚为空
\renewcommand{\cleardoublepage}
{\clearpage\if@twoside \ifodd\c@page\else
            \hbox{}\thispagestyle{empty}\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}
%
% 目录排版
\renewcommand\tableofcontents%
{\chapter{\contentsname}%
    \@mkboth{\MakeUppercase\contentsname}{\MakeUppercase\contentsname}%
    \begin{multicols}{2}
        \@starttoc{toc}%
    \end{multicols}
}
%
% 每章最前的介绍内容环境 intro
\newenvironment{intro}
{\begin{quote}\kaishu\color{gray}}%
        {\end{quote}\par\vspace*{2ex minus 1.5ex}}
%
% 取消过多的 underfull/overfull 警告
\hfuzz=10000pt
\vfuzz=10000pt
\hbadness=10000
\vbadness=10000
%
\endinput
